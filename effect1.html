<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>물총 이펙트 테스트</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #6b7b8d;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px 160px;
            overflow: hidden;
            user-select: none;
        }

        /* 건물 벽 */
        .building {
            background: #7e8e9e;
            padding: 22px;
            border-radius: 6px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.45);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 90px);
            gap: 14px;
        }

        /* 창문 */
        .window {
            width: 90px;
            height: 90px;
            background: rgba(173, 216, 240, 0.65);
            border: 5px solid #8B6914;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            box-shadow: inset 0 0 12px rgba(0, 80, 160, 0.18);
            transition: background 0.1s;
        }
        .window:hover { background: rgba(173, 216, 240, 0.85); }

        /* 창문 십자 프레임 */
        .window::before {
            content: '';
            position: absolute;
            top: 50%; left: -5px; right: -5px;
            height: 4px;
            background: #8B6914;
            transform: translateY(-50%);
            pointer-events: none;
            z-index: 1;
        }
        .window::after {
            content: '';
            position: absolute;
            left: 50%; top: -5px; bottom: -5px;
            width: 4px;
            background: #8B6914;
            transform: translateX(-50%);
            pointer-events: none;
            z-index: 1;
        }

        /* ── 물총 ── */
        .gun-wrap {
            position: fixed;
            bottom: 28px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 60;
        }

        .gun {
            display: flex;
            flex-direction: column;
            align-items: center;
            transform-origin: bottom center;
            transition: transform 0.08s ease-out;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
        }

        .gun-muzzle {
            width: 8px;
            height: 14px;
            background: #0277BD;
            border-radius: 4px 4px 0 0;
        }
        .gun-barrel {
            width: 14px;
            height: 22px;
            background: linear-gradient(to right, #29B6F6 30%, #0288D1 70%);
        }
        .gun-body {
            width: 46px;
            height: 24px;
            background: linear-gradient(135deg, #039BE5 0%, #0277BD 100%);
            border-radius: 8px 8px 3px 3px;
            border: 1.5px solid #01579B;
            box-shadow: inset 0 3px 5px rgba(255,255,255,0.2);
        }
        .gun-tank {
            width: 36px;
            height: 16px;
            background: rgba(130, 210, 255, 0.55);
            border: 2px solid #0288D1;
            border-radius: 8px;
        }
        .gun-grip {
            width: 18px;
            height: 18px;
            background: #01579B;
            border-radius: 0 0 7px 7px;
            border: 1px solid #003c6b;
        }

        /* ── 물줄기 ── */
        .water-stream {
            position: fixed;
            width: 8px;
            border-radius: 4px;
            pointer-events: none;
            z-index: 45;
            transform-origin: bottom center;
        }

        /* ── 창문 젖는 효과 ── */
        .wet-flash {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 2;
            animation: wetFlash 0.4s ease-out forwards;
        }
        @keyframes wetFlash {
            0%   { background: rgba(80, 180, 255, 0.55); }
            100% { background: rgba(80, 180, 255, 0); }
        }
    </style>
</head>
<body>

<div class="building">
    <div class="grid" id="grid"></div>
</div>

<div class="gun-wrap">
    <div class="gun" id="gun">
        <div class="gun-muzzle"></div>
        <div class="gun-barrel"></div>
        <div class="gun-body"></div>
        <div class="gun-tank"></div>
        <div class="gun-grip"></div>
    </div>
</div>

<script>
    const grid    = document.getElementById('grid');
    const gun     = document.getElementById('gun');
    const gunWrap = document.querySelector('.gun-wrap');
    let shooting  = false;

    // 창문 16개 생성
    for (let i = 0; i < 16; i++) {
        const w = document.createElement('div');
        w.className = 'window';
        w.addEventListener('click', () => shoot(w));
        grid.appendChild(w);
    }

    // 총구 위치 (gun 상단 중앙)
    function getMuzzle() {
        const r = gun.getBoundingClientRect();
        return { x: r.left + r.width / 2, y: r.top };
    }

    function shoot(winEl) {
        if (shooting) return;
        shooting = true;

        const wr   = winEl.getBoundingClientRect();
        const tx   = wr.left + wr.width  / 2;
        const ty   = wr.top  + wr.height / 2;

        const { x: mx, y: my } = getMuzzle();
        const dx   = tx - mx;
        const dy   = ty - my;
        const dist = Math.hypot(dx, dy);
        const ang  = Math.atan2(dx, -dy) * (180 / Math.PI);

        // ① 물총 회전
        gun.style.transform = `rotate(${ang}deg)`;

        // ② 물줄기 생성 (총구에서 시작)
        const stream = document.createElement('div');
        stream.className = 'water-stream';
        const bott = window.innerHeight - my;
        Object.assign(stream.style, {
            left:       `${mx - 4}px`,
            bottom:     `${bott}px`,
            height:     '0px',
            background: 'linear-gradient(to top, rgba(0,191,255,0.95) 0%, rgba(135,206,250,0.5) 100%)',
            transform:  `rotate(${ang}deg)`,
            transition: 'height 0.13s linear',
            boxShadow:  '0 0 6px rgba(0,191,255,0.6)',
        });
        document.body.appendChild(stream);

        // 물줄기 늘어남
        requestAnimationFrame(() => requestAnimationFrame(() => {
            stream.style.height = `${dist}px`;
        }));

        // ③ 창문 도달
        setTimeout(() => {
            splash(tx, ty);
            hitWindow(winEl);

            // 물줄기 사라짐
            stream.style.transition = 'opacity 0.12s';
            stream.style.opacity = '0';
            setTimeout(() => stream.remove(), 150);

            // 물총 원위치
            setTimeout(() => {
                gun.style.transform = '';
                shooting = false;
            }, 450);
        }, 145);
    }

    // 물방울 터지는 이펙트
    function splash(cx, cy) {
        const count = 12;
        for (let i = 0; i < count; i++) {
            const sz   = 4 + Math.random() * 8;
            const drop = document.createElement('div');
            Object.assign(drop.style, {
                position:     'fixed',
                width:        `${sz}px`,
                height:       `${sz}px`,
                background:   `rgba(${20 + Math.random()*40 | 0}, ${170 + Math.random()*60 | 0}, 255, 0.85)`,
                borderRadius: '50%',
                left:         `${cx - sz / 2}px`,
                top:          `${cy - sz / 2}px`,
                pointerEvents:'none',
                zIndex:       '100',
            });
            document.body.appendChild(drop);

            const a  = (i / count) * Math.PI * 2 + Math.random() * 0.3;
            const r  = 18 + Math.random() * 38;
            drop.animate([
                { transform: 'translate(0,0) scale(1)', opacity: 1 },
                { transform: `translate(${Math.cos(a)*r}px, ${Math.sin(a)*r}px) scale(0)`, opacity: 0 }
            ], {
                duration: 280 + Math.random() * 200,
                easing: 'ease-out',
                fill: 'forwards',
            }).onfinish = () => drop.remove();
        }
    }

    // 창문 젖는 이펙트
    function hitWindow(winEl) {
        // 파란 플래시
        const flash = document.createElement('div');
        flash.className = 'wet-flash';
        winEl.appendChild(flash);
        setTimeout(() => flash.remove(), 420);

        // 물방울 흘러내리기
        for (let i = 0; i < 5; i++) {
            const drip = document.createElement('div');
            const w    = 3 + Math.random() * 3;
            Object.assign(drip.style, {
                position:     'absolute',
                width:        `${w}px`,
                left:         `${5 + Math.random() * 82}%`,
                top:          '0px',
                borderRadius: '0 0 3px 3px',
                pointerEvents:'none',
                zIndex:       '2',
            });
            winEl.appendChild(drip);

            const color = `rgba(30, ${150 + Math.random()*60 | 0}, 255, 0.75)`;
            drip.animate([
                { height: '0px',  background: color, opacity: 0.9, top: '0px'  },
                { height: '38px', background: color, opacity: 0.6, top: '4px'  },
                { height: '55px', background: color, opacity: 0,   top: '12px' },
            ], {
                duration: 600 + Math.random() * 250,
                delay:    Math.random() * 180,
                easing:   'ease-in',
                fill:     'forwards',
            }).onfinish = () => drip.remove();
        }
    }
</script>
</body>
</html>
